[
{
	"uri": "/aws-edge-sample/en/",
	"title": "Edge Service HoL",
	"tags": [],
	"description": "",
	"content": "Building Global WebCard game based on AWS WebCard is an Web-based 1:1 BlackJack game. You are able to launch this game globally, and play card games with global players. Have Fun!\nNot only source codes for the web-based game, but it also includes AWS best practices to implement online game routing features.\nThis sample includes how to use AWS Edge services for routing web-based persistent games. Using Edge services helps you to minimize end-user latency for your game service.\nIt includes as follows:\nAmazon CloudFront Amazon CloudFront Function AWS Global Accelerator Custom Routing AWS Systems Manager Amazon CloudWatch RUM Pull requests are always welcome. For major changes, please open an issue first to discuss what you would like to change.\nArchitecture This architecture shows how to implement game servers for Global Service.\n  Amazon CloudFront : This helps minimizing end-users accessing latency for your web-based matchmaker. It caches matchmaking web-pages and accelerates dynamic API for optimized web-based matchmaking.\n  Amazon CloudFront Function : In front of Amazon CloudFront, CloudFront Function(CFF) validates end-user\u0026rsquo;s Token before it hits the matchmaker behind. As CFF works at the edge side of Amazon Global Infrastructure, it prevents unverified requests hit matchmaker instances.\n  AWS Global Accelerator Custom Routing : AWS Global Accelerator accelerates user traffics to Game Servers on AWS Cloud. It provides Anycast Static IP address pairs for end-users and helps their traffic routing to game servers fastly and consistently. Custom Routing is one of Global Accelerator\u0026rsquo;s features makes deterministic routing for customers. Due to subnet mapping, it is easy to manage scalable game servers behind AWS Global Accelerator.\n  AWS Systems Manager : AWS Systems Manager is used for providing target subnet id to Matchmaker. Sample code uses Systems Manager - Parameter Stores, but it is also able to use Database to manage connection information.\n  Amazon CloudWatch RUM : Amazon CloudWatch RUM is used for measuring end-user experiences for the application. You are able to evaluate end-user performance \u0026amp; errors \u0026amp; session information inside AWS Console Dashboard. You are also integrating AWS X-Ray, Amazon Cognito and Amazon CloudWatch Logs to analyze.\n  How to Use Step-by-Step guidance is provided. For the additional support, please feel free to contact through the Repository or email(jinspark@amazon.com). :)\n"
},
{
	"uri": "/aws-edge-sample/en/matchmaker/",
	"title": "Web-based Matchmaker",
	"tags": [],
	"description": "",
	"content": "Create Web-based Matchmaker   Move to EC2 Console. Click Launch Instances button.\n  Select Amazon Linux2 AMI.\n  Choose any of instance type and click next.\n  Create EC2 on Public Subnet.\n  Configuring Instance Details, put below shell script to the User Data.\n  #! /bin/sh echo \u0026#34;Setting up NodeJS Environment\u0026#34; curl --silent --location https://rpm.nodesource.com/setup_17.x | bash - yum -y install nodejs # Dot source the files to ensure that variables are available within the current shell npm install pm2 -g --unsafe-perm=true --allow-root npm cache clean --force # Install webcard matchmaker cd ~ curl -O \u0026#34;https://d1zrwss8zuawdm.cloudfront.net/web-card21.zip\u0026#34; unzip web-card21.zip cd ~/web-card21/webcardmatch/ chmod -R 755 ./node_modules npm install -g package --unsafe-perm=true --allow-root # Run pm2 # export BUILD_ID=dontKillMePlease sudo pm2 start app.js -f sudo pm2 startup sudo pm2 save You can also follow this script from cloudinit.sh in source codes.\n"
},
{
	"uri": "/aws-edge-sample/en/cloudfront/",
	"title": "Create CloudFront Distributions",
	"tags": [],
	"description": "",
	"content": "Create CloudFront Distributions   Move to CloudFront Console. Create CloudFront Distribution.\n  Designate Web Matchmaker as an Origin\n  (Important) It is essential to allow \u0026ldquo;GET, HEAD, OPTIONS, PUT, POST, PATCH, DELETE\u0026rdquo; method on CloudFront.\n  Create CloudFront Functions for JWT validation   From the CloudFront page, Click Functions tab on the left side.\n  Click the button \u0026ldquo;Create Function\u0026rdquo;\n  Edit the function code as follows:\n  var crypto = require(\u0026#39;crypto\u0026#39;); //Response when JWT is not valid. var response401 = { statusCode: 401, statusDescription: \u0026#39;Unauthorized\u0026#39; }; function jwt_decode(token, key, noVerify, algorithm) { // check token  if (!token) { throw new Error(\u0026#39;No token supplied\u0026#39;); } // check segments  var segments = token.split(\u0026#39;.\u0026#39;); if (segments.length !== 3) { throw new Error(\u0026#39;Not enough or too many segments\u0026#39;); } // All segment should be base64  var headerSeg = segments[0]; var payloadSeg = segments[1]; var signatureSeg = segments[2]; // base64 decode and parse JSON  var header = JSON.parse(_base64urlDecode(headerSeg)); var payload = JSON.parse(_base64urlDecode(payloadSeg)); if (!noVerify) { var signingMethod = \u0026#39;sha256\u0026#39;; var signingType = \u0026#39;hmac\u0026#39;; // Verify signature. `sign` will return base64 string.  var signingInput = [headerSeg, payloadSeg].join(\u0026#39;.\u0026#39;); if (!_verify(signingInput, key, signingMethod, signingType, signatureSeg)) { throw new Error(\u0026#39;Signature verification failed\u0026#39;); } // Support for nbf and exp claims.  // According to the RFC, they should be in seconds.  if (payload.nbf \u0026amp;\u0026amp; Date.now() \u0026lt; payload.nbf*1000) { throw new Error(\u0026#39;Token not yet active\u0026#39;); } if (payload.exp \u0026amp;\u0026amp; Date.now() \u0026gt; payload.exp*1000) { throw new Error(\u0026#39;Token expired\u0026#39;); } } return payload; }; function _verify(input, key, method, type, signature) { if(type === \u0026#34;hmac\u0026#34;) { return (signature === _sign(input, key, method)); } else { throw new Error(\u0026#39;Algorithm type not recognized\u0026#39;); } } function _sign(input, key, method) { return crypto.createHmac(method, key).update(input).digest(\u0026#39;base64url\u0026#39;); } function _base64urlDecode(str) { return String.bytesFrom(str, \u0026#39;base64url\u0026#39;) } function handler(event) { var request = event.request; //Secret key used to verify JWT token.  //Update with your own key.  var key = \u0026#34;LzdWGpAToQ1DqYuzHxE6YOqi7G3X2yvNBot9mCXfx5k\u0026#34;; // If no JWT token, then generate HTTP redirect 401 response.  if(!request.querystring.jwt) { console.log(\u0026#34;Error: No JWT in the querystring\u0026#34;); return response401; } var jwtToken = request.querystring.jwt.value; try{ var valid = jwt_decode(jwtToken, key); console.log(valid[\u0026#39;name\u0026#39;]); request.headers[\u0026#39;playerid\u0026#39;] = {value: valid[\u0026#39;name\u0026#39;]}; } catch(e) { console.log(e); return response401; } //Remove the JWT from the query string if valid and return.  delete request.querystring.jwt; console.log(\u0026#34;Valid JWT token\u0026#34;); return request; } You can also copy \u0026amp; paste the code from cf2.js.\n Click Publish Tab. And Associate the CloudFront Distribution made above.   Also you should Publish the function to the associated CloudFront Distributions.  "
},
{
	"uri": "/aws-edge-sample/en/gameserver/",
	"title": "Build Game Server",
	"tags": [],
	"description": "",
	"content": "Build Game Server on AWS   Move to VPC Console. Create Private Subnet from your VPC.\n  Move to EC2 Console. Click Launch Instances button.\n  Select Amazon Linux2 AMI.\n  Choose any of instance type and click next.\n  Create EC2 on your Private Subnet. This subnet can be different from Matchmaker\u0026rsquo;s subnet.\n  Configuring Instance Details, put below shell script to the User Data.\n  #! /bin/sh echo \u0026#34;Setting up NodeJS Environment\u0026#34; curl --silent --location https://rpm.nodesource.com/setup_17.x | bash - yum -y install nodejs # Dot source the files to ensure that variables are available within the current shell npm install pm2 -g --unsafe-perm=true --allow-root npm cache clean --force # Install webcard game server cd ~ curl -O \u0026#34;https://d1zrwss8zuawdm.cloudfront.net/web-card21.zip\u0026#34; unzip web-card21.zip cd ~/web-card21/webcard/ chmod -R 755 ./node_modules npm install -g package --unsafe-perm=true --allow-root # Run pm2 # export BUILD_ID=dontKillMePlease sudo pm2 start app.js -f sudo pm2 startup sudo pm2 save You can also check the script from cloudinit.sh\nIf game servers are built, you need to create parameter store to manage game server\u0026rsquo;s network information. This process may not be needed for Production level.\n  Move to SystemsManager console. Click Parameter Store.\n  Create Parameter and put values as follows: Name : webcardSubnetId (Important). Type : String Value : \u0026lt;Subnet ID of Game server\u0026rsquo;s subnet\u0026gt;\n  "
},
{
	"uri": "/aws-edge-sample/en/globalaccelerator/",
	"title": "Global Accelerator Custom Routing",
	"tags": [],
	"description": "",
	"content": "Create AWS Global Accelerator Custom Routing accelerator   Move to Global Accelerator console.\n  Create Custom Routing accelerator.\n  Add Listener with Port range (1001 - 9999) and TCP port.\n    Add Endpoint to the Endpoint Group. Specify subnet id of game servers\u0026rsquo;.\n  Open Game server\u0026rsquo;s security group policy. You should check Global Accelerator IP Range from this Document. But you can open the subnet publicly for the sample.\n  "
},
{
	"uri": "/aws-edge-sample/en/gameplay/",
	"title": "Play the Game",
	"tags": [],
	"description": "",
	"content": "Game Play   Access to the CloudFront domain with JWT. You can make proper token from JWT.IO Default Secret Key is \u0026ldquo;LzdWGpAToQ1DqYuzHxE6YOqi7G3X2yvNBot9mCXfx5k\u0026rdquo;. You can create your own token from it. If you use your own secret key, you should fix the code inside of CloudFront Function. (If you are preparing production workload, please consider how to manage Secret Key securely) (ex) xxx.cloudfront.net?jwt=To.Ke.n\n  When you access to the matchmaker, Click the \u0026ldquo;New Game!\u0026rdquo; Button.\n  Open another game client from the browser. Recommend to use another browser in private mode. Click the New Game Button\n  After matching is completed, the game will soon be started on the Game Server through AWS Global Accelerator.\n   Have fun!  If you have any queries \u0026amp; issues, please feel free to contact me through this repository or email(jinspark@amazon.com). :)\n"
},
{
	"uri": "/aws-edge-sample/en/monitor/",
	"title": "Monitoring Service",
	"tags": [],
	"description": "",
	"content": "Service Monitoring based on CloudWatch RUM   The best way to check end-user experiences is Read User Monitoring (RUM). You are able to evaluate real-user experiences and latency with the test.\n  If you are using Amazon CloudWatch RUM, it is able to analyze end-user traffics inside the AWS Console Dashboard.\n  Move to CloudWatch Console. (us-east-1)\n  Click the RUM button from the Application Monitoring tab on the left side.\n  Click the buttonAdd App Monitor, and start App Monitoring.\n  In this sample, we are going to integrate CloudWatch RUM into Matchmaker. Input App Monitor Name and Application Domain as follows:\n    You should input Top Level Domain(TLD) into Application Domain. Please check whether domain is correct.\n  Collect Performance metrics, Javascript errors and so on.\n   CloudWatch RUM manages User Sessions using Amazon Cognito. Create new Identity Pool as follows:    Click the button Add App Monitor, and create App Monitor.\n  Copy Javascript Snippets from the console, and paste on our source code(/webcardmatch/views/index.html). You should put it inside tag. This should be the upper most tag in the source code.\n    Redeploy the index.html source code on the Matchmaker EC2 instance.\n  Restart the game match. Now we are able to monitor the application using CloudWatch RUM.\n   It is able to monitor real-user performance and end-user session information.   In this sample, I set CloudWatch RUM into matchmaker, but you are able to set it for application server side.  If you have any queries \u0026amp; issues, please feel free to contact me through this repository or email(jinspark@amazon.com). :)\n"
},
{
	"uri": "/aws-edge-sample/en/categories/",
	"title": "Categories",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "/aws-edge-sample/en/tags/",
	"title": "Tags",
	"tags": [],
	"description": "",
	"content": ""
}]