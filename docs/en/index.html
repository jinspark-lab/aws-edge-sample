<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.71.1" />
    <meta name="description" content="AWS Edge service for Global Game Workshop">
<meta name="author" content="Jinsung Thomas Park">

    <link rel="icon" href="/aws-web-card/en/images/favicon.png" type="image/png">

    <title>Edge Service HoL :: Making global games using AWS Edge services</title>

    
    <link href="/aws-web-card/en/css/nucleus.css?1641430731" rel="stylesheet">
    <link href="/aws-web-card/en/css/fontawesome-all.min.css?1641430731" rel="stylesheet">
    <link href="/aws-web-card/en/css/hybrid.css?1641430731" rel="stylesheet">
    <link href="/aws-web-card/en/css/featherlight.min.css?1641430731" rel="stylesheet">
    <link href="/aws-web-card/en/css/perfect-scrollbar.min.css?1641430731" rel="stylesheet">
    <link href="/aws-web-card/en/css/auto-complete.css?1641430731" rel="stylesheet">
    <link href="/aws-web-card/en/css/atom-one-dark-reasonable.css?1641430731" rel="stylesheet">
    <link href="/aws-web-card/en/css/theme.css?1641430731" rel="stylesheet">
    <link href="/aws-web-card/en/css/hugo-theme.css?1641430731" rel="stylesheet">
    
      <link href="/aws-web-card/en/css/theme-aws.css?1641430731" rel="stylesheet">
    

    <script src="/aws-web-card/en/js/jquery-3.3.1.min.js?1641430731"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/aws-web-card/en/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/aws-gamelift-sample/ko">
	<img src="/aws-gamelift-sample/ko/images/logo.png" height="70px"/>
</a>


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-169409427-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-169409427-1');
</script>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/aws-web-card/en/js/lunr.min.js?1641430731"></script>
<script type="text/javascript" src="/aws-web-card/en/js/auto-complete.js?1641430731"></script>
<script type="text/javascript">
    
        var baseurl = "\/aws-web-card\/en\/\/en";
    
</script>
<script type="text/javascript" src="/aws-web-card/en/js/search.js?1641430731"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
         
    </ul>

    
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="/aws-web-card/en/" selected>English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="ko" value="/aws-web-card/ko/">한국어</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      © 2020 Amazon Web Services, Inc. or its Affiliates. All rights reserved.

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
        <div id="head-tags">
        
        </div>
        
          <div id="chapter">
        
        <div id="body-inner">
          

        


<span id="sidebar-toggle-span">
<a href="#" id="sidebar-toggle" data-sidebar-toggle=""><i class="fas fa-bars"></i> navigation</a>
</span>

 
<h1 id="building-global-webcard-game-based-on-aws">Building Global WebCard game based on AWS</h1>
<hr>
<p>WebCard is an Web-based 1:1 BlackJack game.
You are able to launch this game globally, and play card games with global players.
Have Fun!</p>
<p>Not only source codes for the web-based game, but it also includes AWS best practices to implement online game routing features.</p>
<p>This sample includes how to use AWS Edge services for routing web-based persistent games.
Using Edge services helps you to minimize end-user latency for your game service.</p>
<p>It includes as follows:</p>
<ul>
<li>Amazon CloudFront</li>
<li>Amazon CloudFront Function</li>
<li>AWS Global Accelerator Custom Routing</li>
<li>AWS Systems Manager</li>
</ul>
<p>Pull requests are always welcome. For major changes, please open an issue first to discuss what you would like to change.</p>
<h2 id="architecture">Architecture</h2>
<p><img src="https://d1zrwss8zuawdm.cloudfront.net/webcard21-architecture1.png" alt="Image"></p>
<p>This architecture shows how to implement game servers for Global Service.</p>
<ul>
<li>
<p>Amazon CloudFront <br>
: This helps minimizing end-users accessing latency for your web-based matchmaker.
It caches matchmaking web-pages and accelerates dynamic API for optimized web-based matchmaking.</p>
</li>
<li>
<p>Amazon CloudFront Function  <br>
: In front of Amazon CloudFront, CloudFront Function(CFF) validates end-user&rsquo;s Token before it hits the matchmaker behind. As CFF works at the edge side of Amazon Global Infrastructure, it prevents unverified requests hit matchmaker instances.</p>
</li>
<li>
<p>AWS Global Accelerator Custom Routing   <br>
: AWS Global Accelerator accelerates user traffics to Game Servers on AWS Cloud. It provides Anycast Static IP address pairs for end-users and helps their traffic routing to game servers fastly and consistently. Custom Routing is one of Global Accelerator&rsquo;s features makes deterministic routing for customers. Due to subnet mapping, it is easy to manage scalable game servers behind AWS Global Accelerator.</p>
</li>
<li>
<p>AWS Systems Manager    <br>
: AWS Systems Manager is used for providing target subnet id to Matchmaker. Sample code uses Systems Manager - Parameter Stores, but it is also able to use Database to manage connection information.</p>
</li>
</ul>
<h2 id="how-to-use">How to Use</h2>
<h3 id="step-by-step-guidance">Step By Step Guidance</h3>
<p>(1) Create Web-based Matchmaker</p>
<ul>
<li>
<p>Move to EC2 Console. Click Launch Instances button.</p>
</li>
<li>
<p>Select Amazon Linux2 AMI.</p>
</li>
<li>
<p>Choose any of instance type and click next.</p>
</li>
<li>
<p>Create EC2 on Public Subnet.</p>
</li>
<li>
<p>Configuring Instance Details, put below shell script to the User Data.</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">
<span style="color:#75715e">#! /bin/sh</span>

echo <span style="color:#e6db74">&#34;Setting up NodeJS Environment&#34;</span>
curl --silent --location https://rpm.nodesource.com/setup_17.x | bash -
yum -y install nodejs

<span style="color:#75715e"># Dot source the files to ensure that variables are available within the current shell</span>
npm install pm2 -g --unsafe-perm<span style="color:#f92672">=</span>true --allow-root
npm cache clean --force
<span style="color:#75715e"># Install webcard matchmaker</span>
cd ~
curl -O <span style="color:#e6db74">&#34;https://d1zrwss8zuawdm.cloudfront.net/web-card21.zip&#34;</span>
unzip web-card21.zip
cd ~/web-card21/webcardmatch/
chmod -R <span style="color:#ae81ff">755</span> ./node_modules
npm install -g package --unsafe-perm<span style="color:#f92672">=</span>true --allow-root
<span style="color:#75715e"># Run pm2</span>
<span style="color:#75715e"># export BUILD_ID=dontKillMePlease</span>
sudo pm2 start app.js -f
sudo pm2 startup
sudo pm2 save

</code></pre></div><p>You can also follow this script from cloudinit.sh in source codes.</p>
<p>(2) Create CloudFront Distributions</p>
<ul>
<li>
<p>Move to CloudFront Console. Create CloudFront Distribution.</p>
</li>
<li>
<p>Designate Web Matchmaker as an Origin</p>
</li>
<li>
<p>(Important) It is essential to allow &ldquo;GET, HEAD, OPTIONS, PUT, POST, PATCH, DELETE&rdquo; method on CloudFront.</p>
</li>
</ul>
<p>(3) Create CloudFront Functions for JWT validation</p>
<ul>
<li>
<p>From the CloudFront page, Click Functions on the left side.</p>
</li>
<li>
<p>Click the button &ldquo;Create Function&rdquo;</p>
</li>
<li>
<p>Edit the function code as follows:</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">crypto</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;crypto&#39;</span>);

<span style="color:#75715e">//Response when JWT is not valid.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">response401</span> <span style="color:#f92672">=</span> {
    <span style="color:#a6e22e">statusCode</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">401</span>,
    <span style="color:#a6e22e">statusDescription</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Unauthorized&#39;</span>
};

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">jwt_decode</span>(<span style="color:#a6e22e">token</span>, <span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">noVerify</span>, <span style="color:#a6e22e">algorithm</span>) {
    <span style="color:#75715e">// check token
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">token</span>) {
        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;No token supplied&#39;</span>);
    }
    <span style="color:#75715e">// check segments
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">segments</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;.&#39;</span>);
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">segments</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">!==</span> <span style="color:#ae81ff">3</span>) {
        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;Not enough or too many segments&#39;</span>);
    }

    <span style="color:#75715e">// All segment should be base64
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">headerSeg</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">segments</span>[<span style="color:#ae81ff">0</span>];
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">payloadSeg</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">segments</span>[<span style="color:#ae81ff">1</span>];
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">signatureSeg</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">segments</span>[<span style="color:#ae81ff">2</span>];

    <span style="color:#75715e">// base64 decode and parse JSON
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">header</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">_base64urlDecode</span>(<span style="color:#a6e22e">headerSeg</span>));
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">payload</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">_base64urlDecode</span>(<span style="color:#a6e22e">payloadSeg</span>));

    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">noVerify</span>) {
        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">signingMethod</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;sha256&#39;</span>;
        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">signingType</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;hmac&#39;</span>;

        <span style="color:#75715e">// Verify signature. `sign` will return base64 string.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">signingInput</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">headerSeg</span>, <span style="color:#a6e22e">payloadSeg</span>].<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;.&#39;</span>);

        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">_verify</span>(<span style="color:#a6e22e">signingInput</span>, <span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">signingMethod</span>, <span style="color:#a6e22e">signingType</span>, <span style="color:#a6e22e">signatureSeg</span>)) {
            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;Signature verification failed&#39;</span>);
        }

        <span style="color:#75715e">// Support for nbf and exp claims.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// According to the RFC, they should be in seconds.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">payload</span>.<span style="color:#a6e22e">nbf</span> <span style="color:#f92672">&amp;&amp;</span> Date.<span style="color:#a6e22e">now</span>() <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">payload</span>.<span style="color:#a6e22e">nbf</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>) {
            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;Token not yet active&#39;</span>);
        }

        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">payload</span>.<span style="color:#a6e22e">exp</span> <span style="color:#f92672">&amp;&amp;</span> Date.<span style="color:#a6e22e">now</span>() <span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">payload</span>.<span style="color:#a6e22e">exp</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>) {
            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;Token expired&#39;</span>);
        }
    }

    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">payload</span>;
};

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_verify</span>(<span style="color:#a6e22e">input</span>, <span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">method</span>, <span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">signature</span>) {
    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">type</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;hmac&#34;</span>) {
        <span style="color:#66d9ef">return</span> (<span style="color:#a6e22e">signature</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">_sign</span>(<span style="color:#a6e22e">input</span>, <span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">method</span>));
    }
    <span style="color:#66d9ef">else</span> {
        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;Algorithm type not recognized&#39;</span>);
    }
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_sign</span>(<span style="color:#a6e22e">input</span>, <span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">method</span>) {
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">crypto</span>.<span style="color:#a6e22e">createHmac</span>(<span style="color:#a6e22e">method</span>, <span style="color:#a6e22e">key</span>).<span style="color:#a6e22e">update</span>(<span style="color:#a6e22e">input</span>).<span style="color:#a6e22e">digest</span>(<span style="color:#e6db74">&#39;base64url&#39;</span>);
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_base64urlDecode</span>(<span style="color:#a6e22e">str</span>) {
    <span style="color:#66d9ef">return</span> String.<span style="color:#a6e22e">bytesFrom</span>(<span style="color:#a6e22e">str</span>, <span style="color:#e6db74">&#39;base64url&#39;</span>)
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">handler</span>(<span style="color:#a6e22e">event</span>) {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">request</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">request</span>;

    <span style="color:#75715e">//Secret key used to verify JWT token.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//Update with your own key.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">key</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;LzdWGpAToQ1DqYuzHxE6YOqi7G3X2yvNBot9mCXfx5k&#34;</span>;

    <span style="color:#75715e">// If no JWT token, then generate HTTP redirect 401 response.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">querystring</span>.<span style="color:#a6e22e">jwt</span>) {
        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Error: No JWT in the querystring&#34;</span>);
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">response401</span>;
    }

    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">jwtToken</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">querystring</span>.<span style="color:#a6e22e">jwt</span>.<span style="color:#a6e22e">value</span>;
    <span style="color:#66d9ef">try</span>{ 
        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">valid</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">jwt_decode</span>(<span style="color:#a6e22e">jwtToken</span>, <span style="color:#a6e22e">key</span>);
        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">valid</span>[<span style="color:#e6db74">&#39;name&#39;</span>]);
        <span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">headers</span>[<span style="color:#e6db74">&#39;playerid&#39;</span>] <span style="color:#f92672">=</span> {<span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">valid</span>[<span style="color:#e6db74">&#39;name&#39;</span>]};
    }
    <span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">e</span>) {
        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">e</span>);
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">response401</span>;
    }

    <span style="color:#75715e">//Remove the JWT from the query string if valid and return.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">delete</span> <span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">querystring</span>.<span style="color:#a6e22e">jwt</span>;
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Valid JWT token&#34;</span>);
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">request</span>;
}

</code></pre></div><p>You can also copy &amp; paste the code from cf2.js.</p>
<ul>
<li>Click Publish Tab. And Associate the CloudFront Distribution made above.</li>
</ul>
<p><img src="https://d1zrwss8zuawdm.cloudfront.net/webcard21-cf2.png" alt="CF2"></p>
<ul>
<li>Also you should Publish the function to the associated CloudFront Distributions.</li>
</ul>
<p>(4) Create Game Server</p>
<ul>
<li>
<p>Move to VPC Console. Create Private Subnet from your VPC.</p>
</li>
<li>
<p>Move to EC2 Console. Click Launch Instances button.</p>
</li>
<li>
<p>Select Amazon Linux2 AMI.</p>
</li>
<li>
<p>Choose any of instance type and click next.</p>
</li>
<li>
<p>Create EC2 on your Private Subnet. This subnet can be different from Matchmaker&rsquo;s subnet.</p>
</li>
<li>
<p>Configuring Instance Details, put below shell script to the User Data.</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">
<span style="color:#75715e">#! /bin/sh</span>

echo <span style="color:#e6db74">&#34;Setting up NodeJS Environment&#34;</span>
curl --silent --location https://rpm.nodesource.com/setup_17.x | bash -
yum -y install nodejs

<span style="color:#75715e"># Dot source the files to ensure that variables are available within the current shell</span>
npm install pm2 -g --unsafe-perm<span style="color:#f92672">=</span>true --allow-root
npm cache clean --force
<span style="color:#75715e"># Install webcard game server</span>
cd ~
curl -O <span style="color:#e6db74">&#34;https://d1zrwss8zuawdm.cloudfront.net/web-card21.zip&#34;</span>
unzip web-card21.zip
cd ~/web-card21/webcard/
chmod -R <span style="color:#ae81ff">755</span> ./node_modules
npm install -g package --unsafe-perm<span style="color:#f92672">=</span>true --allow-root
<span style="color:#75715e"># Run pm2</span>
<span style="color:#75715e"># export BUILD_ID=dontKillMePlease</span>
sudo pm2 start app.js -f
sudo pm2 startup
sudo pm2 save

</code></pre></div><p>You can also check the script from cloudinit.sh</p>
<p>(5) Create SystemsManager Parameter Store</p>
<ul>
<li>
<p>Move to SystemsManager console. Click Parameter Store.</p>
</li>
<li>
<p>Create Parameter and put values as follows:   <br>
Name : webcardSubnetId (Important).   <br>
Type : String  <br>
Value : &lt;Subnet ID of Game server&rsquo;s subnet&gt;</p>
</li>
</ul>
<p>(6) Create AWS Global Accelerator Custom Routing accelerator</p>
<ul>
<li>
<p>Move to Global Accelerator console.</p>
</li>
<li>
<p>Create Custom Routing accelerator.</p>
</li>
<li>
<p>Add Listener with Port range (1001 - 9999) and TCP port.</p>
</li>
</ul>
<p><img src="https://d1zrwss8zuawdm.cloudfront.net/webcard21-aga.png" alt="AGA"></p>
<ul>
<li>
<p>Add Endpoint to the Endpoint Group. Specify subnet id of game servers&rsquo;.</p>
</li>
<li>
<p>Open Game server&rsquo;s security group policy. You should check Global Accelerator IP Range from <a href="https://docs.aws.amazon.com/global-accelerator/latest/dg/introduction-ip-ranges.html">this Document</a>. But you can open the subnet publicly for the sample.</p>
</li>
</ul>
<p>(7) Run your game</p>
<ul>
<li>
<p>Access to the CloudFront domain with JWT. You can make proper token from <a href="https://jwt.io/">JWT.IO</a>
Default Secret Key is &ldquo;LzdWGpAToQ1DqYuzHxE6YOqi7G3X2yvNBot9mCXfx5k&rdquo;. You can create your own token from it. If you use your own secret key, you should fix the code inside of CloudFront Function. (If you are preparing production workload, please consider how to manage Secret Key securely)     <br>
(ex) xxx.cloudfront.net?jwt=To.Ke.n</p>
</li>
<li>
<p>When you access to the matchmaker, Click the &ldquo;New Game!&rdquo; Button.</p>
</li>
<li>
<p>Open another game client from the browser. Recommend to use another browser in private mode. Click the New Game Button</p>
</li>
<li>
<p>After matching is completed, the game will soon be started on the Game Server through AWS Global Accelerator.</p>
</li>
</ul>
<p><img src="https://d1zrwss8zuawdm.cloudfront.net/webcard21-play.png" alt="GamePlay"></p>
<ul>
<li>Have fun!</li>
</ul>
<p>If you have any queries &amp; issues, please feel free to contact me through this repository or email(<a href="mailto:jinspark@amazon.com">jinspark@amazon.com</a>). :)</p>
<!-- raw HTML omitted -->
	
  
        
            </div> 
        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
            
        
        
        


	 
	 
		
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/aws-web-card/en/js/clipboard.min.js?1641430731"></script>
    <script src="/aws-web-card/en/js/perfect-scrollbar.min.js?1641430731"></script>
    <script src="/aws-web-card/en/js/perfect-scrollbar.jquery.min.js?1641430731"></script>
    <script src="/aws-web-card/en/js/jquery.sticky.js?1641430731"></script>
    <script src="/aws-web-card/en/js/featherlight.min.js?1641430731"></script>
    <script src="/aws-web-card/en/js/highlight.pack.js?1641430731"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/aws-web-card/en/js/modernizr.custom-3.6.0.js?1641430731"></script>
    <script src="/aws-web-card/en/js/learn.js?1641430731"></script>
    <script src="/aws-web-card/en/js/hugo-learn.js?1641430731"></script>

    <link href="/aws-web-card/en/mermaid/mermaid.css?1641430731" rel="stylesheet" />
    <script src="/aws-web-card/en/mermaid/mermaid.js?1641430731"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    
  </body>
</html>

